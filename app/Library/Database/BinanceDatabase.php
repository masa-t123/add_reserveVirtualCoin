<?php

namespace App\Library\Database;

use App\Library\Dto\BinanceDto;
use Illuminate\Support\Facades\DB;

class BinanceDatabase
{
    const TABLE_NAME_PRICE   = 'binance';
    const TABLE_NAME_AVERAGE = 'binance_average';

    private $dbName;

    public function __construct($dbName)
    {
        if(strlen($dbName) <= 0){
            throw new \Exception('テーブル名がセットされていません');
        }
        $this->dbName = $dbName;
    }

    /**
     * 価格情報の挿入
     * @param BinanceDto $dto
     * @throws \Exception
     */
    public function insPriceList(BinanceDto $dto)
    {

        $sql = <<<EOL
insert into $this->dbName (
created_at,
updated_at,
eth,
ltc,
bnb,
neo,
bcc,
gas,
hsr,
mco,
wtc,
lrc,
qtum,
yoyo,
omg,
zrx,
strat,
sngls,
bqx,
knc,
fun,
snm,
iota,
link,
xvg,
ctr,
salt,
mda,
mtl,
sub,
eos,
snt,
etc,
mth,
eng,
dnt,
zec,
bnt,
ast,
dash,
oax,
icn,
btg,
evx,
req,
vib,
trx,
powr,
ark,
xrp,
`mod`,
enj,
storj,
ven,
kmd,
rcn,
nuls,
rdn,
xmr,
dlt,
amb,
bat,
bcpt,
arn,
gvt,
cdt,
gxs,
poe,
qsp,
bts,
xzc,
lsk,
tnt,
fuel,
mana,
bcd,
dgd,
adx,
ada,
ppt,
cmt,
xlm,
cnd,
lend,
wabi,
tnb,
waves,
gto,
icx,
ost,
elf,
aion,
nebl,
brd,
edo,
wings,
nav,
lun,
trig,
appc,
vibe,
rlc,
ins
) values (
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?,
?
)
EOL;

        DB::beginTransaction();

        $result = DB::insert($sql,[
            date('Y-m-d H:i:s'),
            date('Y-m-d H:i:s'),
            $dto->getEth(),
            $dto->getLtc(),
            $dto->getBnb(),
            $dto->getNeo(),
            $dto->getBcc(),
            $dto->getGas(),
            $dto->getHsr(),
            $dto->getMco(),
            $dto->getWtc(),
            $dto->getLrc(),
            $dto->getQtum(),
            $dto->getYoyo(),
            $dto->getOmg(),
            $dto->getZrx(),
            $dto->getStrat(),
            $dto->getSngls(),
            $dto->getBqx(),
            $dto->getKnc(),
            $dto->getFun(),
            $dto->getSnm(),
            $dto->getIota(),
            $dto->getLink(),
            $dto->getXvg(),
            $dto->getCtr(),
            $dto->getSalt(),
            $dto->getMda(),
            $dto->getMtl(),
            $dto->getSub(),
            $dto->getEos(),
            $dto->getSnt(),
            $dto->getEtc(),
            $dto->getMth(),
            $dto->getEng(),
            $dto->getDnt(),
            $dto->getZec(),
            $dto->getBnt(),
            $dto->getAst(),
            $dto->getDash(),
            $dto->getOax(),
            $dto->getIcn(),
            $dto->getBtg(),
            $dto->getEvx(),
            $dto->getReq(),
            $dto->getVib(),
            $dto->getTrx(),
            $dto->getPowr(),
            $dto->getArk(),
            $dto->getXrp(),
            $dto->getMod(),
            $dto->getEnj(),
            $dto->getStorj(),
            $dto->getVen(),
            $dto->getKmd(),
            $dto->getRcn(),
            $dto->getNuls(),
            $dto->getRdn(),
            $dto->getXmr(),
            $dto->getDlt(),
            $dto->getAmb(),
            $dto->getBat(),
            $dto->getBcpt(),
            $dto->getArn(),
            $dto->getGvt(),
            $dto->getCdt(),
            $dto->getGxs(),
            $dto->getPoe(),
            $dto->getQsp(),
            $dto->getBts(),
            $dto->getXzc(),
            $dto->getLsk(),
            $dto->getTnt(),
            $dto->getFuel(),
            $dto->getMana(),
            $dto->getBcd(),
            $dto->getDgd(),
            $dto->getAdx(),
            $dto->getAda(),
            $dto->getPpt(),
            $dto->getCmt(),
            $dto->getXlm(),
            $dto->getCnd(),
            $dto->getLend(),
            $dto->getWabi(),
            $dto->getTnb(),
            $dto->getWaves(),
            $dto->getGto(),
            $dto->getIcx(),
            $dto->getOst(),
            $dto->getElf(),
            $dto->getAion(),
            $dto->getNebl(),
            $dto->getBrd(),
            $dto->getEdo(),
            $dto->getWings(),
            $dto->getNav(),
            $dto->getLun(),
            $dto->getTrig(),
            $dto->getAppc(),
            $dto->getVibe(),
            $dto->getRlc(),
            $dto->getIns(),
        ]);
        if(!$result) {
            DB::rollback();
            throw new \Exception('DBエラー：'.$result);
        }
        DB::commit();

        return;

    }
}